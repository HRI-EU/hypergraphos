class HTMLMenu{constructor(e){this.parentId=e,this.defaultLayout="horizontal",this.menuList={},this.contextName="gojs",this.menuItemParamContextList={},this.menuItemParamD=null,this.parentEl=document.getElementById(this.parentId)}add(e,t){if(e)if(t)this._addMenu(e,t);else for(const n in e)this._addMenu(e,n)}get(e){return this.menuList[e]}addParams(e,t){this.menuItemParamContextList[e]={menuItemParams:t},this.switcheParams(e)}switcheParams(e){this.contextName=e;e=this.menuItemParamContextList[e];this.menuItemParamD=e.menuItemParams}getMenu(e,t){let n=null;if("gojs"===(t=t||"gojs")){t=this.menuItemParamContextList.gojs;const s=t.menuItemParams.diagram;t.getMenuClick=()=>s.lastInput.viewPoint,t.hideContextMenu=()=>{s.currentTool instanceof go.ContextMenuTool&&s.currentTool.doCancel()},n=$(go.HTMLInfo,{show:this._getShowMenuCallback(e,t),hide:this._getHideMenuCallback(e,t)})}return n}_addMenu(e,t){e=e[t];e&&this._newRootMenu(e,t)}_newRootMenu(e,t){var n;e.itemList&&(n=this.parentEl,this._createMenu(e,n,null,t),this.menuList[t]=e)}_createMenu(e,t,n,s){this._createMenuContainer(e,t,n,s),this._createMenuItems(e.itemList,e.element,e)}_createMenuItems(e,t,n){for(const i of e){var s,a;i.fontIcon?this._createItemFontIcon(i,t,n):i.svgIcon?this._createItemSVGIcon(i,t,n):i.label?this._createItemLabel(i,t,n):i.separator&&this._createItemSeparator(i,t,n),i.separator||(i.do&&(i.element.onclick=this._getMenuItemOnClick(i)),i.element&&(i.element.onmouseover=this._getMouseItemOnMouseOver(i))),i.itemList?(this._createMenu(i,t,n),(s=i.element).classList.remove("mdd-menu"),s.classList.add("mdd-menu-inline")):i.subMenu&&(s=i.subMenu,i.subMenu={layout:i.layout,itemList:s},a=i.subMenu,this._createMenu(a,i.element,i))}}_getMenuItemOnClick=t=>{return e=>{e={item:t,event:e,d:this.menuItemParamD};t.do(e)}};_getMouseItemOnMouseOver(s){return e=>{var t,e=e.target,n=s.parent;for(const s of n.itemList)s.subMenu&&this._cleanFullMenu(s.subMenu);s.subMenu&&(n=s.subMenu,t=this.menuItemParamContextList[this.contextName],this._makeMenuVisible(n,n.element,e,t))}}_createMenuContainer(e,t,n,s){e.layout=e.layout||this.defaultLayout,e.parent=n,e.type="container";n=document.createElement("ul");n.classList.add("mdd-menu"),n.classList.add(e.layout),s&&(n.id=s),t.appendChild(n),e.element=n}_createItemFontIcon(e,t,n){e.parent=n,e.type="item";n=document.createElement("span");n.id=e.fontIcon,n.classList.add("oi","mdd-menu-fontIcon"),n.setAttribute("data-glyph",e.fontIcon),n.title=e.hint||"",n.setAttribute("aria-hidden","true"),t.appendChild(n),e.element=n}_createItemSVGIcon(e,t,n){e.parent=n,e.type="item";n=document.createElement("span");n.id=e.svgIcon,n.classList.add("mdd-menu-svgIcon"),n.title=e.hint||"",t.appendChild(n),e.element=n}_createItemLabel(e,t,n){var s=e.subMenu?"...":"",n=(e.parent=n,e.type="item",document.createElement("li"));n.id=e.label,n.className="mdd-menu-label",n.innerHTML=e.label+s,t.appendChild(n),e.element=n}_createItemSeparator(e,t,n){e.parent=n,e.type="item";n=document.createElement("hr");n.className="mdd-menu-separator",t.appendChild(n),e.element=n}_getShowMenuCallback(e,t){const n=this.get(e),s=n.element;let a=!1;return e=>{(a=this._makeMenuVisible(n,s,e,t))&&(t.menuItemParams.obj=e,e=t.getMenuClick(),this._computeRootMenuMouseClickXY(e,s),s.style.left=e.x+5+"px",s.style.top=e.y+"px",window.addEventListener("click",t.hideContextMenu,!0))}}_makeMenuVisible(e,t,n,s){let a=!1;const i={item:null,obj:n,d:s.menuItemParams},m=e=>{for(const t of e.itemList)!(i.item=t).if||t.if(i)?a=!0:(t.element.classList.add("hide-mdd-menu"),delete s.menuItemParams.obj),t.itemList&&m(t)};return m(e),a&&t.classList.add("show-mdd-menu"),a}_getHideMenuCallback(e,t){const n=this.get(e),s=n.element;return()=>{this._makeMenuHidden(n,s),window.removeEventListener("click",t.hideContextMenu,!0)}}_makeMenuHidden(e,t){this._cleanFullMenu(e),t.classList.remove("show-mdd-menu")}_cleanFullMenu(e){for(const t of e.itemList)"item"==t.type&&t.element.classList.remove("hide-mdd-menu"),t.itemList?this._cleanFullMenu(t):t.subMenu&&this._cleanFullMenu(t.subMenu);"container"==e.type&&e.element.classList.remove("show-mdd-menu")}_computeRootMenuMouseClickXY(e,t){var t=getComputedStyle(t),n=parseInt(t.width),t=parseInt(t.height),s=window.innerWidth,a=window.innerHeight;e.x=s-(e.x+100)<n?s-n-50:e.x,e.y=a-(e.y+100)<t?a-t-50:e.y}}