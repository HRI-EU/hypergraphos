/*
  app.js

  Copyright (c) 2019
  Honda Research Institute EUROPE (DEUTSCHLAND) GmbH,
  Carl-Legien-Str.30
  63073 Offenbach/Main
  Germany

  UNPUBLISHED PROPRIETARY MATERIAL.
  ALL RIGHTS RESERVED.

  Author: Antonello Ceravola, Frank Joublin, Andrei Hutuca

  Date: May 05, 2019

  Description: AppReceptionistV2 configuration file

*/

/*
 * User info of server side
 * {
 *   "uid": "501",
 *   "gid": "20",
 *   "username": "antonelloceravola",
 *   "homedir": "/Users/antonelloceravola",
 *   "shell": "/bin/zsh"
 *   "hostname": "avatar-NUC3"
 * }
 *
 * NOTE: you can launch on your shell:
 *
 *   ../avatar-framework/app> node ./getUserInfo.js
 *
 * This command will print the 'ui' value you have currently
 */
const os = require('os');
const ui = os.userInfo();
ui['hostname'] = os.hostname();
/*
 * You can also load shell environment variables like that:
 *
 * const myEnvVariable = process.env['MY_ENV_VARIABLE'];
 *
 * Such environemtn variables could be used in the condition
 * for user configuration
 */

/*
* Defined true if using virtual visitor/db/telephone/...
*/
let isVirtual = false;

// Check if the system should start as virtual
const envIsVirtual = process.env['AVATAR_IS_VIRTUAL'];
if (envIsVirtual == 'TRUE') {
  isVirtual = true;
}

// App Configuration
module.exports = {
  'db': {
    'sqlite': {
      'filename': 'data/db.sqlite',
      // 'password':'avatarPWD
    },
    'consentAutodeleteTime': 7, // in days
  },
  'supervisor': {
    'url': 'wss://localhost:8181/report/ws',
  },
  'services': {
    'api': {
      'enabled': true,
      'path': 'services/api/api-server',
      'endpoint': '/api',
      'ws': '/rpc/ws',
      'routes': {
        'run': {
          'enabled': true,
          'endpoint': '/run',
          'method': 'get',
          'path': 'routes/run',
        },
        'email': {
          'enabled': true,
          'endpoint': '/email',
          'method': 'all',
          'path': 'routes/email',
        },
        'nfc': {
          'enabled': false,
          'endpoint': '/nfc',
          'method': 'get',
          'path': 'routes/nfc',
        },
      },
    },
    'tts': {
      'enabled': true,
      'path': 'services/tts/tts-server',
      'endpoint': '/tts',
      'ws': '/acatts/ws',
    },
    'db': {
      'enabled': true,
      'path': 'services/db/db-server',
      'endpoint': '/db',
    },
    'receptionist-db': {
      'enabled': true,
      'autoPrivacyDeleteEnabled': false,
      'path': 'services/ReceptionistDB/receptionist-db-server',
      'endpoint': '/db/receptionist',
      'options': {
        'maxAge': 0,
        'xlsfile': 'data/visits.ignored.xlsx',
      },
    },
    'nlp': {
      'enabled': true,
      'path': 'services/Nlp/nlp-server',
      'endpoint': '/nlp'
    },
    'face-recognition': {
      'enabled': true,
      'interpreter': 'python3',
      'cwd': 'services/FaceRecognition',
      'process': 'main.py',
    },
    'tel': {
      'enabled': true,
      'path': 'services/Telephony/tel-server',
      'endpoint': '/tel',
      'ws': '/tel/ws',
      // This is for properly loading acapela outside of its own process
      // TODO: find a better solution
      'env': {
        'LD_LIBRARY_PATH': 'node_modules/@avatar-framework/server/lib/acatts',
      },
    },
    'sip-proxy': {
      'enabled': true,
      'interpreter': 'python3',
      'cwd': 'services/Telephony/SipProxy/voiproxy',
      'process': 'mainserver.py',
      'args': [],
      'env': {
        'LD_LIBRARY_PATH': `${process.env.HOME}/.local/lib`,
      },
    },
    'led': {
      'enabled': true,
      'path': 'services/LedController/led/led-server',
      'endpoint': '/led',
      'ws': '/led/ws',
      'options': {
        'serialPort': '/dev/ttyUSB0',
        'timeout': 5000,
      },
    },
    'usb-ctrl': {
      'enabled': true,
      'path': 'services/UsbHubCtrl/usb-ctrl-server',
      'endpoint': '/usbctrl',
    },
    'remote-log': {
      'enabled': true,
      'path': 'services/RemoteLog/remote-log',
    },
    'statistics': {
      'enabled': true,
      'path': 'services/StatisticsTool/statistics',
    },
  },
  'tts': {
    'acapela': {
      'host': '127.0.0.1',
    },
    'cache': {
      'enabled': true,
      'folder': '/tmp/AvatarCache',
    },
  },
  'server': {
    'port': 9595,
    'ssl': {
      'enabled': true,
      'key': 'server.key',
      'cert': 'server.cert',
    },
    'logs': {
      'folder': '/tmp/AvatarCache',
    }
  },
  'email': {
    'host': 'hermes.honda-ri.de',
    'port': 25,
    'senderEmail': 'receptionist@honda-ri.de',
    'senderName': 'Avatar Receptionist',
  },
  'sip': {
    'sipProxy': '127.0.0.1',
    'sipServer': '127.0.0.1',
    'commandPort': 5000,
    'audioTcpPort': 5001,
    'forwardIncomingAudio': false,
    'speechRecognition': {
      'enabled': true,
      'host': '192.168.0.8',
      'dictionary': [],
      'voiceRecParams': {
        'language': 'en',
        'transcriptionLanguage': 'en-GB',
        'enablePartialTranscripts': true,
        'timeoutBeforeRecognition': 0,
        'timeoutAfterRecognition': 0,
      },
    },
  },
  'logger': {
    'port': 7235,
    'outDir': './logs/',
    'defaultRoute': './client/statistics.html',
    'dbStorage': './data/statistics.ignored.sqlite',
    'ssl': {
      'enabled': true,
      'key': 'config/server.key',
      'cert': 'config/server.cert',
    },
  },
  'statistics': {
    'port': 7236,
    'loggerPort': 7235,
    'loggerUrl': 'localhost',
    'clientPath': '../StatisticsTool/client',
    'defaultRoute': '/statistics.html',
    'dbStorage': './data/statistics.ignored.sqlite',
    'ssl': {
      'enabled': true,
      'key': 'config/server.key',
      'cert': 'config/server.cert',
    },
  },
  'client': {
    'version': '5.1.0',
    'logLevel': 0,
    'verboseLog': false,
    'clientName': 'receptionist',
    'isVirtual': isVirtual,
    'consentAutodeleteTime': 7,
    'remoteLog': {
      'url': 'wss://192.168.178.20:7235',
    },
    'speechRecognitionUrl': '192.168.1.26',
    'faceRecognitionUrl': 'wss://192.168.178.66:8766',
    'commandsUrl': 'wss://192.168.178.66:8767',
    'sipUser': '224',
    'sipPassword': '224',
    'appConfig': {
      'name': 'AppReceptionistV2',
      'plugin': [
        'src/plugin/Meisy',
        'src/plugin/Narrator',
        'src/plugin/Human',
        'src/plugin/GeometricPrimitiveEntity',
        'src/plugin/ScreenEntity',
        'src/plugin/SpeechSynthAcapela',
        // 'src/plugin/SpeechSynthGTR',
        // 'src/plugin/SpeechSynth',
        'src/plugin/SpeechRecognitionSM',
        'src/plugin/SpeechRecognitionWSA',
        'src/plugin/UserInput',
        'src/plugin/EMail',
        //'src/plugin/DebugGUI',
      ],
      'include': [
        'app/privacy-ui/PrivacyUI.js',
        'app/lib/RequestUserInteraction/RequestUserInteraction.js',

        'app/lib/RemoteLog/RemoteLog.js',

        'app/lib/QueryBase/QueryBase.js',

        // DB
        'lib/DbAPI/DbAPI.js',
        'app/lib/ReceptionistDB/ReceptionistDB.js',

        // Telephony
        'app/lib/Telephony/TelMessageType.js',
        'app/lib/Telephony/Telephony.js',

        // Arduino
        'app/lib/LedController/LedCommands.js',
        'app/lib/LedController/LedController.js',
        'app/lib/ProximitySensor/ProximitySensor.js',

        'app/lib/AvatarBasicBehaviors/AvatarBasicBehaviors.js',
        'app/lib/MironSystem/MironSystem.js',
        'app/lib/MironSystem/Nlp.js',
        'app/lib/BehaviorEngine/ActivitySet.js',
        'app/lib/BehaviorEngine/BehaviorEngineInternalActions.js',
        'app/lib/BehaviorEngine/BehaviorEngine.js',

        'app/RealWorldInterface.js',
        'app/getModalityTypeList.js',
        'app/getMirons.js',
        'app/getRules_Receptionist.js',
        'app/getMapList_Receptionist.js',

        'app/AvatarReceptionist.js',
        'app/AppReceptionistV2.js',
      ],
      'executable': 'app/main.js',
      'supervisor': {
        'url': 'wss://localhost:8181/report/ws',
      },
    },
  },
}

/* Switch between Virtual and Real services */
if (isVirtual) {
  module.exports['client']['appConfig']['include'].push(
    'app/lib/AudioSystem/AudioSystemVirtual.js',

    'app/AvatarVisitorVirtual.js',
    'app/getRules_Visitor.js',
    'app/getMapList_Visitor.js',

    'app/lib/ProximitySystem/ProximitySystemVirtual.js',
    'app/lib/StatusLEDSystem/StatusLEDSystemVirtual.js',
    //'app/lib/NameDictionarySystem/NameDictionarySystemVirtual.js',
    'app/lib/NameDictionarySystem/NameDictionarySystem.js',

    'app/lib/VisionSystem/VisionSystemVirtual.js',
    'app/lib/TelephonySystem/TelephonySystemVirtual.js',
    'app/lib/EmailSystem/EmailSystemVirtual.js',

    'app/lib/LongTermMemory/VisitorLongTermMemoryVirtual.js',
    'app/lib/LongTermMemory/ReceptionistLongTermMemoryVirtual.js',
    //'app/lib/LongTermMemory/ReceptionistLongTermMemory.js',
  );
} else {
  module.exports['client']['appConfig']['include'].push(
    'app/lib/AudioSystem/AudioSystem.js',

    'app/AvatarVisitor.js',
    'app/getRules_Human.js',
    'app/getMapList_Human.js',

    'app/lib/ProximitySystem/ProximitySystemVirtual.js',
    'app/lib/StatusLEDSystem/StatusLEDSystem.js',
    'app/lib/NameDictionarySystem/NameDictionarySystem.js',

    'app/lib/VisionSystem/VisionSystem.js',
    'app/lib/TelephonySystem/TelephonySystem.js',
    'app/lib/EmailSystem/EmailSystem.js',

    'app/lib/LongTermMemory/VisitorLongTermMemory.js',
    'app/lib/LongTermMemory/ReceptionistLongTermMemory.js',
  );
}

/* User specific configuration */

// Antonello @ Home
if (ui.hostname == 'avatar-NUC3') {
  module.exports['client']['speechRecognitionUrl'] = '192.168.1.13';
  module.exports['sip']['sipServer'] = '192.168.1.44';
  module.exports['sip']['speechRecognition']['host'] = '192.168.1.13';
  module.exports['client']['remoteLog']['url'] = 'wss://192.168.1.2:7235';
  module.exports['client']['faceRecognitionUrl'] = 'wss://192.168.1.2:8766';
  module.exports['client']['commandsUrl'] = 'wss://192.168.1.2:8767';
  module.exports['client']['appConfig']['supervisor']['url'] = 'wss://192.168.1.2:8181/report/ws';
  module.exports['email'] = {
    'host': 'smtp.gmail.com',
    'port': 587,
    'senderEmail': 'MeisyAvatar@gmail.com',
    'senderName': 'Avatar Receptionist',
    'auth': {
      'user': 'MeisyAvatar@gmail.com',
      'pass': 'Avatar-123',
    },
  };
}
// Frank @ Home
else if (ui.hostname == 'avatar-NUC1') {
  module.exports['client']['speechRecognitionUrl'] = '192.168.178.79';
  module.exports['sip']['sipServer'] = '192.168.178.33';
  module.exports['sip']['speechRecognition']['host'] = '192.168.178.79';
  module.exports['client']['remoteLog']['url'] = 'wss://192.168.178.25:7235';
  module.exports['client']['faceRecognitionUrl'] = 'wss://192.168.178.25:8766';
  module.exports['client']['commandsUrl'] = 'wss://192.168.178.25:8767';
  module.exports['client']['appConfig']['supervisor']['url'] = 'wss://192.168.178.25:8181/report/ws';
  module.exports['services']['usb-ctrl']['enabled'] = false;
  module.exports['email'] = {
    'host': 'smtp.gmail.com',
    'port': 587,
    'senderEmail': 'MeisyAvatar@gmail.com',
    'senderName': 'Avatar Receptionist',
    'auth': {
      'user': 'MeisyAvatar@gmail.com',
      'pass': 'Avatar-123',
    },
  };
}
// Andrei H, Cristian and Andrei J @ RINF
else if ((ui.username == 'cristian') || (ui.username == 'chris') || (ui.username == 'ahutuca') || (ui.username == 'andrei')) {
  module.exports['client']['speechRecognitionUrl'] = '192.168.0.29';
  module.exports['client']['remoteLog']['url'] = 'wss://localhost:7235';
  module.exports['sip']['sipServer'] = '127.0.0.1';
  module.exports['tts']['acapela']['host'] = '192.168.0.113';
}
// Booth @ HREG Lobby
else if (ui.hostname == 'tux-booth-03') {
  /*
    HREG SIP Info
      User: hrieu_avatar
      Password: Avatar01
      NUMBER: +496989011748
      TFTP Server: 172.26.19.13
      Outbound Proxy: 172.26.19.13
      Other Server: 172.26.19.12
      CTI Server: cucmsub.eu.mds.honda.com:5060
  */
  module.exports['client']['speechRecognitionUrl'] = '10.107.144.108'; // TODO: Speechmatics
  module.exports['sip']['sipServer'] = '172.26.19.13'; // TODO: Either HRI SIP or a FreePBX VM
  module.exports['client']['sipUser'] = '+496989011748';
  module.exports['client']['sipPassword'] = 'Avatar01';
  module.exports['client']['sipAuthuser'] = 'hrieu_avatar';
  module.exports['services']['sip-proxy']['args'] = ['--rtp-port-range', 32000, 65000, '--rtp-address=192.168.186.99']; // This will bind the RTP process on the right interface
  module.exports['sip']['speechRecognition']['host'] = '10.107.144.108'; // TODO: Speechmatics
  module.exports['client']['remoteLog']['url'] = 'wss://10.107.144.43:7235'; // TODO: check this
  module.exports['client']['faceRecognitionUrl'] = 'wss://10.107.144.43:8766'; // TODO: tux-booth-03 IP address
  module.exports['client']['commandsUrl'] = 'wss://10.107.144.43:8767'; // TODO: tux-booth-03 IP address
  module.exports['client']['appConfig']['supervisor']['url'] = 'wss://10.107.144.43:8181/report/ws'
  module.exports['tts']['acapela']['host'] = '10.107.144.111'; // TODO: Acapela, not accesible from LLN

}
// Linux Desktop Frankonello @ Office
else if (ui.hostname == 'tux-37') {
  module.exports['client']['speechRecognitionUrl'] = 'speechmatics.honda-ri.de'; // '172.26.0.169'; // TODO: Speechmatics
  module.exports['sip']['sipServer'] = '172.26.19.10'; // TODO: Either HRI SIP or a FreePBX VM
  module.exports['client']['sipUser'] = '748';
  module.exports['client']['sipPassword'] = '987123';
  module.exports['sip']['speechRecognition']['host'] = 'speechmatics.honda-ri.de'; // '172.26.0.169'; // TODO: Speechmatics
  module.exports['client']['remoteLog']['url'] = 'wss://172.26.1.167:7235'; // TODO: check this
  module.exports['client']['faceRecognitionUrl'] = 'wss://172.26.1.167:8766'; // TODO: tux-booth-03 IP address
  module.exports['client']['commandsUrl'] = 'wss://172.26.1.167:8767'; // TODO: tux-booth-03 IP address
  module.exports['tts']['acapela']['host'] = 'hri-acapela.honda-ri.de'; // TODO: Acapela, not accesible from LLN
}
// Linux Desktop at Siddhata office
else if (ui.hostname == 'talos-29') {
  // TODO: booth PC config
  module.exports['client']['speechRecognitionUrl'] = 'speechmatics.honda-ri.de'; // '172.26.0.169'; // TODO: Speechmatics
  module.exports['sip']['sipServer'] = '172.26.19.10'; // TODO: Either HRI SIP or a FreePBX VM
  module.exports['client']['sipUser'] = '748';
  module.exports['client']['sipPassword'] = '987123';
  module.exports['sip']['speechRecognition']['host'] = 'speechmatics.honda-ri.de'; // '172.26.0.169'; // TODO: Speechmatics
  module.exports['client']['remoteLog']['url'] = 'wss://172.26.1.129:7235'; // TODO: check this
  module.exports['client']['faceRecognitionUrl'] = 'wss://172.26.1.129:8766'; // TODO: tux-booth-03 IP address
  module.exports['client']['commandsUrl'] = 'wss://172.26.1.129:8767'; // TODO: tux-booth-03 IP address
  module.exports['tts']['acapela']['host'] = '172.26.0.179'; // TODO: Acapela, not accesible from LLN
}

// Remote Linux Session for Siddhata
else if (ui.hostname == 'cuda4xl-02') {
  // TODO: booth PC config
  module.exports['client']['speechRecognitionUrl'] = 'speechmatics.honda-ri.de'; // '172.26.0.169'; // TODO: Speechmatics
  module.exports['sip']['sipServer'] = '172.26.19.10'; // TODO: Either HRI SIP or a FreePBX VM
  module.exports['client']['sipUser'] = '748';
  module.exports['client']['sipPassword'] = '987123';
  module.exports['sip']['speechRecognition']['host'] = 'speechmatics.honda-ri.de'; // '172.26.0.169'; // TODO: Speechmatics
  module.exports['client']['remoteLog']['url'] = 'wss://172.26.1.129:7230'; // TODO: check this
  module.exports['client']['faceRecognitionUrl'] = 'wss://172.26.1.129:8766'; // TODO: tux-booth-03 IP address
  module.exports['client']['commandsUrl'] = 'wss://172.26.1.129:8767'; // TODO: tux-booth-03 IP address
  module.exports['tts']['acapela']['host'] = '172.26.0.179'; // TODO: Acapela, not accesible from LLN
}
